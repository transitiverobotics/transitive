[Unit]
Description=Transitive Robotics Package Update Service

[Service]
# System call sandboxing
SystemCallArchitectures=native
NoNewPrivileges=true

WorkingDirectory=%h/.transitive
EnvironmentFile=%h/.transitive/.env
Environment=TRPACKAGE=%i

# generate a random password for this package to use
ExecStartPre=%h/.transitive/usr/bin/node -e "fs.writeFileSync('%h/.transitive/packages/%i/password', Math.random().toString(36).substr(2, 9))"

ExecStart=/bin/bash -c "%h/.transitive/unshare.sh \"cd /home/transitive && . /opt/ros/*/setup.bash && PATH=/home/usr/bin:$PATH && npm update && cd node_modules/@transitive-robotics/%i && env PASSWORD=\$(cat ../../../password) npm start\""

# Note: npm update also installs missing packages, see,
# https://stackoverflow.com/a/19824154/1087119
